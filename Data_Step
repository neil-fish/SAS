*This file is SAS data step cheatsheet;
*CAS, Cloud Analytic Service is a SAS cloud remote service. Most SAS data step statement also fit in CAS; 

libname libref "file_path";
/*Most Common Structure
DATA work.input(......); 
SET libref.datset(KEEP=A RENAME=(A=B) WHERE=(B=1) REPLACE= YES FIRSTOBS=2 OBS=10 IN=indicator);
FORMAT B 10.2;
FORMAT C $6.;
FORMAT DATE date9.;
RUN;
*/


/*
Automatic Data Step Variable
SAS dataset has these veriabls in the data step: 
_N_
*/

/*
Dataset Options:
1  rename variables
2  select only the first or last n observations for processing
3  drop variables from processing or from the output dataset
4  specify a password for a dataset

Most SAS data set options apply to either input or output SAS data sets in DATA steps or procedure (PROC) steps. 
If a data set option is associated with an input data set, the action applies to the data set that is being read. 
If the data set option appears in the DATA statement or after an output data set specification in a PROC step, SAS applies the action to the output data set. 

When data set options appear in input and output data sets in the same DATA or PROC step, 
SAS first applies data set options to input data sets. 
Then SAS evaluates programming statements or applies data set options to output data sets.

Timing can also be an issue in some cases. 
For example, if you are using KEEP= and RENAME= on a data set that is specified in the SET statement, 
KEEP= needs to use the original variable names. SAS processes KEEP= before the data set is read. 
The new names that are specified in RENAME= apply to the programming statements that follow the SET statement.

Many system options and data set options share the same name and have the same function. 
System options remain in effect for all DATA steps and PROC steps in a SAS job or session.
The data set option overrides the system option for the data set in the step in which it appears.
  eg:
  options obs=100; system options    
  data final;
     set two(obs=5) three;  dataset options
  run;

Syntax DATA libref.dataset(OPTIONS);  eg: DATA old(rename=(date=Start_Date));

Data Set Control	
ALTER= password	                                      - Assigns an ALTER= password to a SAS file that prevents users from replacing or deleting the file, and enables access to a read- and write-protected file.
COMPRESS= NO | YES | CHAR | BINARY                    - Specifies how observations are compressed in a new output SAS data set. In general, COMPRESS=CHAR provides good compression when single bytes repeat, eg:"aaaaaa"; COMPRESS=BINARY provides good compression when strings of bytes repeat, eg:"abcabc".
DLDMGACTION= FAIL | ABORT | REPAIR | NOINDEX | PROMPT - Specifies the action to take when a SAS data set in a SAS library is detected as damaged. 
                                                        FAIL:stops the step and issues an error message to the log immediately. This is the default for batch mode.
                                                        ABORT:stops the step, issues an error message to the log, and terminates the SAS session.
                                                        REPAIR:attempts to automatically repair a damaged data set on the next attempt to open the damaged file. The data set might truncate at the point of damage. The REPAIR option re-creates the index or indexes. If the damage is too severe, the auto repair attempt might not be successful.
                                                        NOINDEX:automatically repairs the data file without the indexes and integrity constraints. 
                                                        PROMPT:displays a dialog box that asks you to select the FAIL, ABORT, REPAIR, or NOINDEX action.
ENCRYPT= AES | AES2 | NO | YES                        - No by default. Specifies whether to encrypt an output SAS data set.
                                                        AES | AES2: encryption methodology. must use encryptkey=password to assign password
                                                        YES: must use read=password to assign password
ENCRYPTKEY= password                                  - Specifies a key value for AES (Advanced Encryption Standard) encryption.
                                                        1 to 64 bytes; not supported in a DATA step that runs in CAS; Use only with SAS 9.4 or later; Use only with AES-encrypted data files.
READ= password                                        - Assigns a READ= password to a SAS file that prevents users from reading the file, unless they enter the password.
                                                        not supported in a DATA step that runs in CAS.
INDEX= (variable(s) </UNIQUE> </NOMISS> )             - Defines an index for a new output SAS data set.
                                                        data new(index=(ssn));
                                                        data new(index=(cityst=(city state)));
                                                        data new(index=(ssn /unique));
                                                        data new(index=(ssn /nomiss));
                                                        data new(index=(ssn /unique/nomiss cityst=(city state) /unique/nomiss));
LABEL= 'label'                                        - Specifies a label for a SAS data set.
                                                        a text string of up to 256 bytes. 
                                                        If the label text contains single quotation marks, enclose the label in double quotation marks. 
                                                        To remove a label from a data set, assign a blank space that is enclosed in quotation marks to the label.
                                                        You can also use two single quotation marks in the label text and enclose the string in single quotation marks.
PW= password                                          - Assigns a READ, WRITE, and ALTER password to a SAS file, and enables access to a password-protected SAS file.
                                                        password must be a valid SAS name, which limits the password to eight characters and is case-insensitive.
REPEMPTY= YES | NO                                    - Specifies whether a new, empty data set can overwrite an existing SAS data set.
                                                        By default is YES. Suggest to set it NO
REPLACE= NO | YES                                     - Specifies whether a new SAS data set that contains data can overwrite an existing data set.
                                                        Use REPLACE=YES and REPEMPTY=NO for the convenience of replacing existing data sets with new ones that contain data.
SORTEDBY= by-clause</ collate-name> | _NULL_          - Specifies how a data set is currently sorted. No need to sort the dataset again 
                                                        by-clause: names the variables and options that you use in a BY statement in a PROC SORT step.
                                                        collate-name: names the collating sequence that is used for the sort. By default, the collating sequence is that of your operating environment. A slash (/) must precede the collating sequence. 
                                                        _NULL_: removes any existing sort indicator.
TYPE= data-set-type                                   - Specifies the data set type for a specially structured SAS data set.
                                                        You can use the CONTENTS procedure to determine the type of data set.
                                                        Most SAS data sets do not have a specified type. 
                                                        However, there are several specially structured SAS data sets that are used by some SAS/STAT procedures. 
                                                        Some of the special data sets are CORR, COV, SSPC, EST, and FACTOR.
WRITE= write-password                                 - Assigns a WRITE= password to a SAS file that prevents users from writing to a file, unless the users enter the password.
                                                        must be a valid SAS name.
Observation Control	
FIRSTOBS= n | nK | nM | nG | hexX | MIN | MAX         - Specifies the first observation that SAS processes in a SAS data set.
                                                        n | nK | nM | nG: 8 specifies the eighth observation, and a value of 3k specifies 3,072.
                                                        hexX: 2dx sets the 45th observation as the first observation to process.
                                                        MIN: sets the number of the first observation to process to 1. This is the default.
                                                        MAX: sets the number of the first observation to process to the maximum number of observations in the data set. This number can be up to the largest eight-byte, signed integer, which is 263â€“1, or approximately 9.2 quintillion observations.
IN= variable                                          - Creates a Boolean variable that indicates whether the data set contributed data to the current observation.
                                                        variable names the new variable whose value indicates whether the input data set contributed data to the current observation. Within the DATA step, the value of the variable is 1 if the data set contributed to the current observation. Otherwise, the value is 0.
OBS= n | nK | nM | nG | nT | hexX | MIN | MAX         - Specifies the last observation that SAS processes in a data set.
POINTOBS= YES | NO                                    - Specifies whether SAS creates compressed data sets whose observations can be randomly accessed or sequentially accessed.
                                                        YES: need to access data by observation number in a compressed data set. It does increase CPU usage by approximately 10%
                                                        NO: do not need to access data by observation number in a compressed data set
                                                        Because POINTOBS=YES is the default when you use compression, REUSE=YES causes POINTOBS= to change to NO
WHERE= (where-expression-1 <logical-operator where-expression-2> )
                                                      - Specifies specific conditions to use to select observations from a SAS data set.
                                                        where-expression is an arithmetic or logical expression that consists of a sequence of operators, operands, and SAS functions. 
                                                        logical-operator can be AND, AND NOT, OR, or OR NOT.
                                                        The expression must be enclosed in parentheses.
Variable Control	
DROP= variable(s)                                     - For an input data set, excludes the specified variables from processing; for an output data set, excludes the specified variables from being written to the data set.
KEEP= variable(s)                                     - For an input data set, specifies the variables to process; for an output data set, specifies the variables to write to the data set.
RENAME= (old-variable-name-1=new-variable-name-1 <old-variable-name-2=new-variable-name-2 ...> )
                                                      - Changes the name of a variable.
                                                        If you use RENAME= with WHERE processing such as a WHERE statement or a WHERE= data set option, the new name is applied before the data is processed. You must use the new name in the WHERE expression.
                                                        The DROP= and KEEP= data set options are applied before RENAME=. You must use the old name in the DROP= and KEEP= data set options. 
*/

/*Format
A format is a type of SAS language element that applies a pattern to or executes instructions for a data value to be displayed or written as output. 
Types of formats correspond to the type of data: numeric, character, date, time, or timestamp. 
The ability to create user-defined formats is also supported. 
Examples of SAS formats are BINARY, DATE, and WORDS. For example, the WORDS22. format, which converts numeric values to their equivalent in words, writes the numeric value 692 as six hundred ninety-two.

Syntax:
<$>format<w>.<d>                                      - $: indicates a character format. Its absence indicates a numeric format.
                                                      - format: names the format. The format is a SAS format or a user-defined format that was previously defined with the VALUE statement in PROC FORMAT.
                                                      - w: pecifies the format width, which for most formats is the number of columns in the output data.
                                                      - d: specifies an optional decimal scaling factor in the numeric formats.
eg:
DOLLAR10.2
the w value of 10 specifies a maximum of 10 columns for the value. 
The d value of 2 specifies that two of these columns are for the decimal part of the value, which leaves eight columns for the remaining characters in the value. 
The remaining columns include the decimal point, the remaining numeric value, a minus sign if the value is negative, the dollar sign, and commas, if any.

Attention Point:
If the format width is too narrow to represent a value, SAS tries to squeeze the value into the space available. 
Character formats truncate values on the right. Numeric formats sometimes revert to the BESTw.d format. 
SAS prints asterisks if you do not specify an adequate width. In the following example, the result is x=**.
If you use an incompatible format, such as a numeric format to write character values, SAS first attempts to use an analogous format of the other type. 
If this attempt fails, an error message that describes the problem is displayed in the SAS log.
When the value of d is greater than 15, the precision of the decimal value after the 15th significant digit might not be accurate.

You can use formats in these ways:
in a PUT statement                                    - The PUT statement with a format after the variable name uses a format to write data values in a DATA step. PUT statement writes a value to an external destination (either the SAS log or a destination, that you specify).
                                                        amount=1145.32;
                                                        put amount dollar10.2;
with the PUT, PUTC, or PUTN functions                 - The PUT function converts a numeric variable, a character variable, or a constant by using any valid format and then returns the resulting character value. PUT works in compile step while PUTC and PUTN work in run time.
                                                        num=15;
                                                        char=put(num,hex2.); *char has a character value;
with the %SYSFUNC macro function                      - The %SYSFUNC (or %QSYSFUNC) macro function executes SAS functions or user-defined functions and applies an optional format to the function outside a DATA step. 
                                                        %macro tst(amount);
                                                          %put %sysfunc(putn(&amount,dollar10.2));
                                                        %mend tst;
in a FORMAT statement in a DATA step or a PROC step   - The FORMAT statement permanently associates character variables with character formats and numeric variables with numeric formats.
                                                        format sales1-sales3 comma10.2;
in an ATTRIB statement in a DATA step or a PROC step  - The ATTRIB statement can also associate a format, as well as other attributes, with one or more variables.
                                                        attrib sales1-sales3 format=comma10.2;

Common Format:
Character
$CHARw. $w.                                           - standard character data
$BINARYw. $HEXw. $OCTALw.                             - Converts character data to binary, hexadecimal, octal
$QUOTEw.                                              - Writes data values that are enclosed in double quotation marks.
$REVERJw. $REVERSw.                                   - Writes character data in reverse order and preserves blanks/Writes character data in reverse order and left aligns
$UPCASEw.                                             - Converts character data to uppercase.
$VARYINGw.                                            - Writes character data of varying length.
Numeric
BESTw.                                                - SAS chooses the best notation.
BESTDw.                                               - Prints numeric values, lining up decimal places for values of similar magnitude, and prints integers without decimals.
COMMAw.d                                              - Writes numeric values with a comma that separates every three digits and a period that separates the decimal fraction.
DOLLARw.d                                             - Writes numeric values with a leading dollar sign, a comma that separates every three digits, and a period that separates the decimal fraction.
w.d                                                   - standard numeric data one digit per byte.
WORDSw.                                               - Writes numeric values as words.
Datetime                                
DATEw.                                                - w specifies the width of the output field. w's range is 5-11, default 7
                                                        date5.  15MAR
                                                        date6.   15MAR
                                                        date7.  15MAR18
                                                        date8.   15MAR18
                                                        date9.  15MAR2018
                                                        date11. 15-MAR-2018
DATEAMPMw.d/MDYAMPMw.d                                - w specifies the width of the output field. w's range is 7-40, default 19
                                                        d specifies the number of digits to the right of the decimal point in the seconds value. This argument is optional. d's range is 0â€“39, must smaller than w.
DATETIMEw.d                                           - w specifies the width of the output field. w's range is 7-40, default 16
                                                        d specifies the number of digits to the right of the decimal point in the seconds value. This argument is optional. d's range is 0â€“39, must smaller than w.
DAYw./MONTHw./QTRw./YEARw.                            - 
DDMMYYw./MMDDYYw/YYMMDDw.                             - Writes date values in the form ddmm<yy>yy or dd/mm/<yy>yy, where a forward slash is the separator and the year appears as either 2 or 4 digits.
                                                        w specifies the width of the output field. w's range is 2-10, default 8
DDMMYYxw./MMDDYYxw./YYMMDDxw.                         - Writes date values in the form ddmm<yy>yy or dd-mm-yy<yy>, where the x in the format name is a character that represents the special character that separates the day, month, and year. The special character can be a hyphen (-), period (.), blank character, slash (/), colon (:), or no separator; the year can be either 2 or 4 digits.
                                                        w specifies the width of the output field. w's range is 2-10, default 8
                                                        x identifies a separator or specifies that no separator appear between the day, the month, and the year. The following values are valid for x:
                                                          B separates with a blank
                                                          C separates with a colon
                                                          D separates with a hyphen
                                                          N indicates no separator
                                                          P separates with a period
                                                          S separates with a slash.
*/
